(function($,undefined){$.validator={defaults:{required:true,msgRequired:"必选项",tip:{tipShow:false,msg:""},rules:{},msg:{},msgType:1,adAction:"blur",ajaxValidator:false,error:function(){return true}},formDefaults:{formID:false,msgTipID:false,start:function(){return true},end:function(){return true}},regex:{intege:/^-?[1-9]\d*$/,intege1:/^[1-9]\d*$/,intege2:/^-[1-9]\d*$/,num:/^([+-]?)\d*\.?\d+$/,num1:/^[1-9]\d*|0$/,num2:/^-[1-9]\d*|0$/,decmal:/^([+-]?)\d*\.\d+$/,decmal1:/^[1-9]\d*.\d*|0.\d*[1-9]\d*$/,decmal2:/^-([1-9]\d*.\d*|0.\d*[1-9]\d*)$/,decmal3:/^-?([1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0)$/,decmal4:/^[1-9]\d*.\d*|0.\d*[1-9]\d*|0?.0+|0$/,decmal5:/^(-([1-9]\d*.\d*|0.\d*[1-9]\d*))|0?.0+|0$/,email:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,color:/^[a-fA-F0-9]{6}$/,chinese:/^[\u4E00-\u9FA5\uF900-\uFA2D]+$/,ascii:/^[\x00-\xFF]+$/,zipcode:/^\d{6}$/,mobile:/^(13[0-9]|15[012356789]|18[0256789]|147)[0-9]{8}$/,notempty:/^\S+$/,picture:/(.*)\.(jpg|bmp|gif|ico|pcx|jpeg|tif|png|raw|tga)$/,rar:/(.*)\.(rar|zip|7zip|tgz)$/,date:/^((0?\d)|(1[012]))\/([012]?\d|30|31)\/\d{1,4}$/,qq:/^[1-9]*[1-9][0-9]*$/,tel:/^(([0\+]\d{2,3}-)?(0\d{2,3})-)?(\d{7,8})(-(\d{3,}))?$/,username:/^\w+$/,letter:/^[A-Za-z]+$/,letter_u:/^[A-Z]+$/,letter_l:/^[a-z]+$/,isCardID:function(num,$obj){var iSum=0,sId=$obj.val(),info="";if(!/^\d{17}(\d|x)$/i.test(sId)){return false}sId=sId.replace(/x$/i,"a");sBirthday=sId.substr(6,4)+"-"+Number(sId.substr(10,2))+"-"+Number(sId.substr(12,2));var d=new Date(sBirthday.replace(/-/g,"/"));if(sBirthday!=(d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate())){return false}for(var i=17;i>=0;i--){iSum+=(Math.pow(2,i)%11)*parseInt(sId.charAt(17-i),11)}if(iSum%11!=1){return false}return true},required:function(num,$obj){if($.validator.tool.emptyVal($obj)<=0){return false}return true},minLen:function(num,$obj){if($.validator.tool.isLength($obj.val())<num){return false}return true},maxLen:function(num,$obj){if($.validator.tool.isLength($obj.val())>num){return false}return true},min:function(num,$obj){if($obj.val()<num){return false}return true},max:function(num,$obj){if($obj.val()>num){return false}return true},select:function(num,$obj){var rVal=$.validator.tool.RCinput($obj);if(rVal<num){return false}return true},isTime:function(str){var a=str.match(/^(\d{1,2})(:)?(\d{1,2})\2(\d{1,2})$/);if(a==null){return false}if(a[1]>24||a[3]>60||a[4]>60){return false}return true},isDate:function(str){var r=str.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(r==null)return false;var d=new Date(r[1],r[3]-1,r[4]);return true},isDateTime:function(str){var reg=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/;var r=str.match(reg);if(r==null)return false;var d=new Date(r[1],r[3]-1,r[4],r[5],r[6],r[7]);return true},callRegex:function(rule,val,$obj){var that=$.validator.regex;if(that[rule]){if($.isFunction(that[rule])){return that[rule](val,$obj)}else{if((that[rule]).test($obj.val())){return true}}}return false}},tool:{ajaxObj:{},ajaxSettings:function(obj,setting){var settings={isvalid:false,lastValid:"",type:"GET",url:"",addidvalue:true,datatype:"html",data:"",async:true,cache:false,beforesend:function(){return true},success:function(){return true},complete:function(){},processdata:false,error:function(){},buttons:null,onerror:"服务器校验没有通过",onwait:"正在等待服务器返回数据",validatetype:"AjaxValidator"};this.ajaxObj[obj]=$.extend(true,settings,setting)},ajaxValid:function(returnObj){var id=returnObj;var obj=id;var srcjo=$("#"+id);var setting=this.ajaxObj[returnObj];var ls_url=setting.url;var errorType="error";if(!ls_url){return}if(setting.addidvalue){var parm="clientid="+id+"&"+id+"="+encodeURIComponent(srcjo.val());ls_url=ls_url+(ls_url.indexOf("?")>0?("&"+parm):("?"+parm))}$.ajax({mode:"abort",type:setting.type,url:ls_url,cache:setting.cache,data:setting.data,async:setting.async,dataType:setting.datatype,success:function(data){if(setting.success(data)){$.validator.messages.showTip(obj,"","ok");setting.isvalid=true}else{$.validator.messages.showTip(obj,setting.onerror,errorType);setting.isvalid=false}},complete:function(){if(setting.buttons&&setting.buttons.length>0){setting.buttons.attr({"disabled":false})};setting.complete},beforeSend:function(xhr){if(setting.buttons&&setting.buttons.length>0){setting.buttons.attr({"disabled":true})};var isvalid=setting.beforesend(xhr);if(isvalid){setting.isvalid=false;$.validator.messages.showTip(obj,setting.onwait,errorType)}setting.lastValid="-1";return isvalid},error:function(){$.validator.messages.showTip(obj,setting.onerror,errorType);setting.isvalid=false;setting.error()},processData:setting.processdata})},emptyVal:function($obj){var type=$obj.attr("type"),inputName;switch(type){case"text":return $obj.val().length||0;break;case"select":return $obj.val()||0;break;case"radio":inputName=$obj.attr("name");return $("input[name='"+inputName+"']:checked").length||0;break;case"checkbox":inputName=$obj.attr("name");return $("input[name='"+inputName+"']:checked").length||0;break}return $obj.val().length||0},isLength:function(str){var cArr=str.match(/[^\x00-\xff]/ig);return str.length+(cArr==null?0:cArr.length)},RCinput:function($obj){var inputName,type=$obj.attr("type");if(!type){return false}switch(type){case"radio":inputName=$obj.attr("name");return $("input[name='"+inputName+"']:checked").length||0;break;case"checkbox":inputName=$obj.attr("name");return $("input[name='"+inputName+"']:checked").length||0;break;default:return false;break}}},messages:{getIdTip:function(id){return $("."+id+"_tip")},showTip:function(id,str,sty){var $obj=this.getIdTip(id);var box,sty=sty||"error";box='<span class="'+sty+'"><label>'+str+'</label></span>';$obj.html(box)},reShowTip:function(id,type){var $obj;if(type==2){$obj=id}else{$obj=this.getIdTip(id)}$obj.html("")}},control:{tip:{deTip:function($obj,str){var errorStr=str||"error",obj=$obj.attr('id');$.validator.messages.showTip(obj,errorStr,"tip")}},combo:function(formID,arg){var subList=$.validator.ruleList[formID],lsobj;if(!arg){return}if(!!subList){for(var i in arg){if(subList[i]){subList[i]=$.extend(true,subList[i],arg[i])}else{subList[i]=$.extend({},$.validator.defaults,arg[i])}}}else{subList=$.validator.ruleList[formID]={};for(var r in arg){subList[r]=$.extend({},$.validator.defaults,arg[r])}}},tipFoucs:function(formID,i){var curF=$.validator.ruleList[formID][i],$obj=$("#"+i);if(curF.tip.tipShow){$.validator.control.tip.deTip($obj,curF.tip.msg)}},init:function(formID,arg){var formIDList;formIDList=$.validator.ruleList[formID];if(!formIDList&&!arg){return}for(var i in arg){(function(i){var curRule=formIDList[i];var rule=curRule.rules,$obj=$("#"+i);if(!!curRule.bindtype){return}curRule.bindtype=true;if($obj.size()<=0){return}if($obj.attr("type")=="radio"||$obj.attr("type")=="checkbox"){$obj=$("input[name='"+$obj.attr("name")+"']")}$obj.bind("focus",function(){$.validator.control.tipFoucs(formID,i,false)});if(!!rule){$obj.bind(curRule.adAction,function(){var msgID=i,errorFlag=true,errorType=curRule.msgType||1;errorType=errorType==1?"error":"other";if(!!curRule.msgId){msgID=curRule.msgId}if(curRule.tip.tipShow&&$(this).val().length<=0){$.validator.messages.reShowTip(msgID)}else{if($.validator.tool.emptyVal($(this))<=0){return}for(var r in rule){if(!$.validator.regex.callRegex(r,rule[r],$(this))){errorFlag=false;$.validator.messages.showTip(msgID,curRule.msg[r],errorType);curRule.error();break}}if(!errorFlag){return}if(curRule.ajaxValidator){if(!$.validator.tool.ajaxObj[i]){$.validator.tool.ajaxSettings(i,curRule.ajaxValidator)}$.validator.tool.ajaxValid(i)}else{$.validator.messages.showTip(msgID,"","ok")}}})}})(i)}},fromAply:function(formID){var data=$.validator.ruleList[formID],result=true,that=$.validator;if(!data){return false}for(var i in data){var r,rule,$obj=$("#"+i),errorObj=i,errorType,oldTip;if(i!="formConfig"&&$obj.size()>0){rule=data[i].rules;oldTip=data[i].tip.tipShow;errorType=data[i].msgType||1;errorType=errorType==1?"error":"other";if(!!data[i].msgId){errorObj=data[i].msgId}if($.validator.tool.emptyVal($obj)>0){for(var r in rule){if(!$.validator.regex.callRegex(r,rule[r],$obj)){result=false;data[i].tip.tipShow=false;$("#"+errorObj).focus();data[i].tip.tipShow=oldTip;setTimeout(function(){that.messages.showTip(errorObj,data[i].msg[r],errorType)},1);break}}}else{if(data[i].required){result=false;data[i].tip.tipShow=false;$("#"+errorObj).focus();data[i].tip.tipShow=oldTip;setTimeout(function(){that.messages.showTip(errorObj,data[i].msgRequired,errorType)},1)}}if(!!$.validator.tool.ajaxObj[i]&&$.validator.tool.ajaxObj[i].isvalid===false){result=false;data[i].tip.tipShow=false;$("#"+errorObj).focus();data[i].tip.tipShow=oldTip}if(!result){break}that.messages.showTip(errorObj,"","ok")}}if(result){return true}else{return false}}},ruleList:{},formConfig:function(arg){var subList,formID;var formC=$.extend({},$.validator.formDefaults,arg);if(!formC.formID){return}formID=arg.formID;if(!$.validator.ruleList[formID]){$.validator.ruleList[formID]={}}$.validator.ruleList[formID]["formConfig"]={};subList=$.validator.ruleList[formID]["formConfig"];for(var i in formC){subList[i]=formC[i]}$("#"+formID).submit(function(){if($.isFunction(subList.start)){subList.start()};var vf=$.validator.control.fromAply(formID);if($.isFunction(subList.end)){subList.end()};return vf})},addMethod:function(name,methond){$.validator.regex[name]=methond}};$.fn.extend({validator:function(arg,start,end){return this.each(function(){var obj,formID;if(this.tagName.toLowerCase()=="form"){formID=this.id}if(!formID){return}if(arg){$.validator.control.combo(formID,arg);$.validator.control.init(formID,arg)}})}})})(jQuery);